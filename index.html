<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amma's Digital Scoldings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'warm-beige': '#F5F1E8',
                        'off-white': '#FEFCF7',
                        'warm-maroon': '#8B4B3B',
                        'dark-green': '#2D5016'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .malayalam-text {
            font-family: 'Inter', 'Noto Sans Malayalam', sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-off-white to-warm-beige flex items-center justify-center p-4">
    <div class="w-full max-w-md mx-auto">
         Main Card 
        <div class="bg-off-white rounded-2xl shadow-lg border border-warm-beige/50 p-8 text-center">
             Title Section 
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-warm-maroon mb-2">
                    Amma's Digital Scoldings
                </h1>
                <p class="text-lg text-dark-green malayalam-text font-medium">
                    അമ്മയുടെ വഴക്ക്
                </p>
            </div>

             Text Display Area 
            <div id="scoldingDisplay" class="bg-warm-beige/30 border border-warm-beige rounded-lg p-6 mb-6 min-h-[120px] flex items-center justify-center">
                <p class="text-gray-600 italic" id="scoldingText">
                    Press the button to hear what Amma has to say...
                </p>
            </div>

             Button 
            <button 
                id="scoldingButton" 
                class="w-full bg-warm-maroon hover:bg-warm-maroon/90 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 disabled:hover:scale-100 mb-6"
                onclick="getScolding()"
            >
                Get a Scolding!
            </button>

             Audio Player (Hidden by default) 
            <div id="audioContainer" class="hidden">
                <audio id="audioPlayer" controls class="w-full rounded-lg">
                    Your browser does not support the audio element.
                </audio>
            </div>
        </div>

         Footer 
        <div class="text-center mt-6">
            <p class="text-sm text-gray-500">
                Made with ❤️ for nostalgic memories
            </p>
        </div>
    </div>

    <script>
        // API Configuration
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`;

        // DOM Elements
        const scoldingButton = document.getElementById('scoldingButton');
        const scoldingText = document.getElementById('scoldingText');
        const audioContainer = document.getElementById('audioContainer');
        const audioPlayer = document.getElementById('audioPlayer');

        // Main function to get scolding
        async function getScolding() {
            try {
                // Set loading state
                setLoadingState(true);
                
                // Generate scolding text using Gemini API
                const scoldingContent = await generateScoldingText();
                
                // Display the generated text
                displayScolding(scoldingContent);
                
                // Generate speech from text (placeholder for Sarvam API)
                await generateSpeechFromText(scoldingContent);
                
            } catch (error) {
                console.error('Error generating scolding:', error);
                displayError('Amma is taking a break. Try again later!');
            } finally {
                // Reset button state
                setLoadingState(false);
            }
        }

        // Set loading state
        function setLoadingState(isLoading) {
            if (isLoading) {
                scoldingButton.disabled = true;
                scoldingButton.textContent = 'Thinking of a good one...';
                scoldingText.textContent = '';
                scoldingText.className = 'text-gray-500 italic';
                hideAudioPlayer();
            } else {
                scoldingButton.disabled = false;
                scoldingButton.textContent = 'Get a Scolding!';
            }
        }

        // Generate scolding text using Gemini API
        async function generateScoldingText() {
            const prompt = "Generate a short, funny, and typical scolding a Malayali mother would say to her child for being lazy or wasting time. The response must be in Malayalam, but written using only English letters (Manglish). Keep it to one or two sentences.";
            
            const requestBody = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }],
                generationConfig: {
                    temperature: 0.9,
                    topK: 1,
                    topP: 1,
                    maxOutputTokens: 100,
                }
            };

            const response = await fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`Gemini API error: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                return data.candidates[0].content.parts[0].text.trim();
            } else {
                throw new Error('Invalid response from Gemini API');
            }
        }

        // Display the generated scolding
        function displayScolding(text) {
            scoldingText.textContent = text;
            scoldingText.className = 'text-dark-green font-medium text-lg leading-relaxed';
        }

        // Display error message
        function displayError(message) {
            scoldingText.textContent = message;
            scoldingText.className = 'text-red-500 italic';
        }

        // Placeholder function for Sarvam API (Text-to-Speech)
        async function generateSpeechFromText(text) {
            // TODO: User will add the Sarvam API fetch call here
            
            // Placeholder logic for handling audio response
            // This code structure is ready to be used with the actual audio data
            
            try {
                // When the user implements the Sarvam API call, they should:
                // 1. Make the fetch call to Sarvam API with the text parameter
                // 2. Receive the audio response (likely as ArrayBuffer or Blob)
                // 3. Create a Blob URL from the audio data
                // 4. Set the audio player source and make it visible
                // 5. Optionally auto-play the audio
                
                // Example structure for when audio data is received:
                /*
                const audioBlob = new Blob([audioData], { type: 'audio/mpeg' });
                const audioUrl = URL.createObjectURL(audioBlob);
                
                audioPlayer.src = audioUrl;
                showAudioPlayer();
                audioPlayer.play();
                
                // Clean up the URL when audio ends
                audioPlayer.addEventListener('ended', () => {
                    URL.revokeObjectURL(audioUrl);
                });
                */
                
                console.log('Text to convert to speech:', text);
                console.log('Sarvam API integration pending...');
                
            } catch (error) {
                console.error('Error in speech generation:', error);
                // Handle speech generation errors gracefully
            }
        }

        // Show audio player
        function showAudioPlayer() {
            audioContainer.classList.remove('hidden');
        }

        // Hide audio player
        function hideAudioPlayer() {
            audioContainer.classList.add('hidden');
            audioPlayer.src = '';
        }

        // Add some visual feedback on button hover
        scoldingButton.addEventListener('mouseenter', function() {
            if (!this.disabled) {
                this.style.transform = 'scale(1.05)';
            }
        });

        scoldingButton.addEventListener('mouseleave', function() {
            if (!this.disabled) {
                this.style.transform = 'scale(1)';
            }
        });
    </script>
</body>
</html>
